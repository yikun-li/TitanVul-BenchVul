# Realistic Vulnerability Generation - RVG

A multi-agent system for generating synthetic vulnerability samples for security research and training. This pipeline
uses four AI agents to create realistic vulnerable code implementations along with their fixes, providing comprehensive
datasets for vulnerability analysis and remediation studies.

## Overview

The pipeline employs a four-agent system that collaborates to generate complete vulnerability scenarios:

1. **Context & Threat Modeler**: Generates realistic application contexts and identifies attack vectors
2. **Vulnerable Implementer**: Creates vulnerable code implementations based on the generated contexts
3. **Security Auditor**: Analyzes vulnerabilities and implements secure fixes
4. **Security Reviewer**: Reviews and verifies the effectiveness of remediation

## Usage

### Basic Usage

```bash
# Generate vulnerability samples with OpenAI GPT-4
python main.py --provider openai --model gpt-4o

# Use Anthropic Claude
python main.py --provider anthropic --model claude-3-sonnet-20240229
```

### Advanced Options

```bash
# Use specific programming languages
python main.py --languages Python Java JavaScript

# Custom output directory
python main.py --output-dir results --target-count 50

# Generate samples for specific CWE types only
python main.py --specific-cwe CWE-89 CWE-78 CWE-22
```

## Output Format

The pipeline generates multiple output formats for each vulnerability sample:

### JSON Output

```json
{
  "cwe_id": "CWE-89",
  "vulnerability_type": "SQL Injection",
  "context_and_attack_vectors": {
    "application_context": {
      "name": "E-commerce Product Search",
      "description": "Online shopping platform with product search functionality",
      "primary_language": "Python",
      "technology_stack": [
        "Flask",
        "SQLAlchemy",
        "PostgreSQL"
      ],
      "user_roles": [
        "Customer",
        "Admin",
        "Vendor"
      ]
    },
    "attack_vectors": [
      {
        "name": "SQL Injection via Search Parameter",
        "description": "Malicious SQL injection through product search input",
        "impact": "Database compromise, data theft",
        "likelihood": "High"
      }
    ]
  },
  "vulnerable_code": "def search_products(search_term):\n    query = f\"SELECT * FROM products WHERE name LIKE '%{search_term}%'\"\n    ...",
  "remediation_data": {
    "Remediated Code": "def search_products(search_term):\n    query = \"SELECT * FROM products WHERE name LIKE %s\"\n    cursor.execute(query, (f'%{search_term}%',))\n    ..."
  },
  "security_review": {
    "vulnerable_code_analysis": {
      "has_target_vulnerability": true,
      "is_syntax_correct": true
    },
    "remediated_code_analysis": {
      "has_target_vulnerability": false,
      "is_syntax_correct": true
    },
    "remediation_successful": true
  }
}
```

## Context Management

The pipeline includes sophisticated context management to ensure diversity:

- **Uniqueness Checking**: Prevents duplicate application contexts
- **FIFO Strategy**: Maintains a rolling window of recent contexts
- **Language Distribution**: Balanced selection across programming languages
- **Technology Stack Diversity**: Varied technology combinations

## Project Structure

```
vulnerability-generation-pipeline/
├── agents/
│   ├── __init__.py
│   ├── context_threat_modeler.py    # Generates contexts and attack vectors
│   ├── vulnerable_implementer.py    # Creates vulnerable code
│   ├── security_auditor.py          # Implements security fixes
│   └── security_reviewer.py         # Reviews remediation effectiveness
├── api/
│   ├── __init__.py
│   ├── base_client.py               # Abstract API client
│   ├── openai_client.py             # OpenAI API implementation
│   └── anthropic_client.py          # Anthropic API implementation
├── config/
│   ├── __init__.py
│   └── settings.py                  # Configuration management
├── utils/
│   ├── __init__.py
│   ├── file_utils.py                # File operations and result saving
│   ├── context_manager.py           # Context uniqueness and diversity
│   └── logging_utils.py             # Logging utilities
├── pipeline.py                      # Main pipeline orchestrator
├── main.py                          # CLI entry point
└── README.md
```
