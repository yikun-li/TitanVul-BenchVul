# Vulnerability Fixing Detection Pipeline

A multi-agent system for detecting whether code changes are attempts to fix security vulnerabilities. This pipeline uses
three AI agents (Auditor, Critic, and Consensus) to analyze code diffs and determine the likelihood that a change
addresses a security vulnerability.

## Overview

The pipeline employs a three-agent system inspired by the multi-agent design pattern:

1. **Auditor Agent**: Analyzes code changes to determine if they fix security vulnerabilities
2. **Critic Agent**: Reviews and critiques the Auditor's analysis for completeness and accuracy
3. **Consensus Agent**: Makes final decisions based on both agents' outputs, assigning a possibility score (0-3)

## Consensus Scoring System

- **Score 0**: Definitely NOT a vulnerability fix (feature additions, refactoring, performance improvements)
- **Score 1**: Unclear or ambiguous (conflicting evidence, insufficient context)
- **Score 2**: Probably a vulnerability fix attempt (security-related changes with some ambiguity)
- **Score 3**: Definitely a vulnerability fix attempt (clear security patches, explicit vulnerability remediation)

## Input Format

The pipeline expects a CSV file with the following columns:

- `func_before`: Original function code (before changes)
- `func_after`: Modified function code (after changes)
- `commit_message`: Commit message providing context
- `cwe_id`: CWE identifier for the vulnerability type

## Usage

### Basic Usage

```bash
# Process vulnerability fixes with OpenAI GPT-4
python main.py --input input_data.csv --provider openai --model gpt-4o

# Use Anthropic Claude
python main.py --input input_data.csv --provider anthropic --model claude-3-sonnet-20240229
```

## Project Structure

```
vulnerability-detection-pipeline/
├── agents/
│   ├── __init__.py
│   ├── auditor_agent.py      # Analyzes code changes for vulnerabilities
│   ├── critic_agent.py       # Reviews auditor's analysis
│   └── consensus_agent.py    # Makes final decisions
├── api/
│   ├── __init__.py
│   ├── base_client.py        # Abstract API client
│   ├── openai_client.py      # OpenAI API implementation
│   └── anthropic_client.py   # Anthropic API implementation
├── config/
│   ├── __init__.py
│   └── settings.py           # Configuration management
├── utils/
│   ├── __init__.py
│   ├── csv_file_utils.py     # CSV file operations
│   └── logging_utils.py      # Logging utilities
├── pipeline.py               # Main pipeline orchestrator
├── main.py                   # CLI entry point
├── example_input_data.csv    # Sample input file
└── README.md
```
